from aiogram.types import InlineKeyboardButton, InlineKeyboardMarkup, WebAppInfo
from aiogram.utils.keyboard import InlineKeyboardBuilder

from data.db_connect import get_session
from data.services_requests import get_services
from data.stock_requests import get_all_stocks

from config import settings


async def add_review_keyboard():
    """
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞
    """
    review_clinic_keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [
                InlineKeyboardButton(
                    text="üí¨–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –Ω–∞ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∞—Ö",
                    web_app=WebAppInfo(url=settings.YANDEX_MAP_URL)
                )
            ],
            [
                InlineKeyboardButton(
                    text="üí¨–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ",
                    web_app=WebAppInfo(url=settings.VK_URL)
                )
            ],
            [
                InlineKeyboardButton(
                    text="üí¨–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –Ω–∞ –ê–í–ò–¢–û",
                    web_app=WebAppInfo(url=settings.AVITO_URL)
                )
            ],
            [InlineKeyboardButton(text="‚û°Ô∏è–ù–∞ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é‚¨ÖÔ∏è",
                                  callback_data="main_keyboard")],
        ]
    )
    return review_clinic_keyboard


async def select_repair_services_keyboard(category_id: int):
    """
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏ —Ä–µ–º–æ–Ω—Ç–∞
    """
    keyboard = InlineKeyboardBuilder()
    async for session in get_session():
        all_services = await get_services(session=session, category_id=category_id)
        if all_services:  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –Ω–µ None
            for service in all_services:
                keyboard.add(InlineKeyboardButton(text=service.title, callback_data=f"service_{service.id}"))
    keyboard.add(InlineKeyboardButton(text='‚û°Ô∏è–ù–∞ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é‚¨ÖÔ∏è', callback_data="main_keyboard"))
    return keyboard.adjust(1).as_markup()


async def select_tuning_services_keyboard(category_id: int):
    """
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏ —Ç—é–Ω–∏–Ω–≥–∞
    """
    keyboard = InlineKeyboardBuilder()
    async for session in get_session():
        all_services = await get_services(session=session, category_id=category_id)
        if all_services:  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –Ω–µ None
            for service in all_services:
                keyboard.add(InlineKeyboardButton(text=service.title, callback_data=f"service_{service.id}"))
    keyboard.add(InlineKeyboardButton(text='‚û°Ô∏è–ù–∞ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é‚¨ÖÔ∏è', callback_data="main_keyboard"))
    return keyboard.adjust(1).as_markup()


async def chip_tuning_keyboard():
    """
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏ —á–∏–ø-—Ç—é–Ω–∏–Ω–≥–∞
    """
    keyboard = InlineKeyboardBuilder()
    keyboard.add(InlineKeyboardButton(
                text="‚úèÔ∏è–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º",
                url=settings.SUPPORT_URL,
            ))
    keyboard.add(InlineKeyboardButton(text='‚û°Ô∏è–ù–∞ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é‚¨ÖÔ∏è', callback_data="main_keyboard"))
    return keyboard.adjust(1).as_markup()


async def service_keyboard(category_id: int):
    """
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞  '–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É'
    """
    keyboard = InlineKeyboardBuilder()
    keyboard.add(InlineKeyboardButton(
                text="‚úèÔ∏è–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º",
                url=settings.SUPPORT_URL,
            ))
    keyboard.add(InlineKeyboardButton(text="‚úèÔ∏è–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –¢—é–Ω–∏–Ω–≥", callback_data="submit_application"))
    keyboard.add(InlineKeyboardButton(text='‚û°Ô∏è–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –º–µ–Ω—é‚¨ÖÔ∏è', callback_data=f"back_services_{category_id}"))
    keyboard.add(InlineKeyboardButton(text='‚û°Ô∏è–ù–∞ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é‚¨ÖÔ∏è', callback_data="main_keyboard"))
    return keyboard.adjust(1).as_markup()


async def select_stocks_keyboard():
    """
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–∫—Ü–∏–∏
    """
    keyboard = InlineKeyboardBuilder()
    async for session in get_session():
        all_stocks = await get_all_stocks(session=session)
        if all_stocks:
            for stock in all_stocks:
                keyboard.add(InlineKeyboardButton(text=stock.title, callback_data=f"stock_{stock.id}"))
    keyboard.add(InlineKeyboardButton(text='‚û°Ô∏è–ù–∞ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é‚¨ÖÔ∏è', callback_data="main_keyboard"))
    return keyboard.adjust(1).as_markup()


async def stock_keyboard():
    """
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –∞–∫—Ü–∏—é
    """
    keyboard = InlineKeyboardBuilder()
    keyboard.add(InlineKeyboardButton(
                text="‚úèÔ∏è–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º",
                url=settings.SUPPORT_URL,
            ))
    keyboard.add(InlineKeyboardButton(text="–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –ø–æ –∞–∫—Ü–∏–∏", callback_data="submit_application"))
    keyboard.add(InlineKeyboardButton(text='‚û°Ô∏è–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –º–µ–Ω—é‚¨ÖÔ∏è', callback_data="back_stocks"))
    keyboard.add(InlineKeyboardButton(text='‚û°Ô∏è–ù–∞ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é‚¨ÖÔ∏è', callback_data="main_keyboard"))
    return keyboard.adjust(1).as_markup()